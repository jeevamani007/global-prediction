<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Banking Domain Analyzer - File Upload</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Upload CSV, Excel, or SQL files for banking domain analysis">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <style>
        :root {
            --primary: #1a56db;
            --primary-dark: #1e40af;
            --primary-light: #3b82f6;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-shadow: 0 10px 40px rgba(0, 0, 0, 0.12);
            --border-radius: 16px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 40px 20px;
            color: #1f2937;
            line-height: 1.6;
        }

        .container {
            background: #ffffff;
            padding: 48px;
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 1000px;
            box-shadow: var(--card-shadow);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.25rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .header p {
            font-size: 1.1rem;
            color: #6b7280;
            max-width: 600px;
            margin: 0 auto;
        }

        .upload-zone {
            border: 3px dashed var(--primary-light);
            padding: 60px 40px;
            text-align: center;
            cursor: pointer;
            border-radius: 12px;
            background: linear-gradient(135deg, #f0f5ff 0%, #f8fafc 100%);
            transition: all 0.3s ease;
            margin-bottom: 24px;
        }

        .upload-zone:hover {
            background: linear-gradient(135deg, #e0e7ff 0%, #f0f5ff 100%);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .upload-zone.dragover {
            background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
            border-color: var(--primary-dark);
            transform: scale(1.02);
        }

        .upload-zone .icon {
            font-size: 3.5rem;
            margin-bottom: 16px;
        }

        .upload-zone h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .upload-zone p {
            font-size: 0.95rem;
            color: #6b7280;
        }

        .file-types {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 16px;
        }

        .file-type-badge {
            background: var(--primary);
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        input[type="file"] {
            display: none;
        }

        .file-list {
            background: #f8fafc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 24px;
            display: none;
            border: 1px solid #e5e7eb;
        }

        .file-list.show {
            display: block;
        }

        .file-list h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid #e5e7eb;
        }

        .file-item:last-child {
            margin-bottom: 0;
        }

        .file-item .name {
            font-weight: 500;
            color: #1f2937;
        }

        .file-item .size {
            font-size: 0.9rem;
            color: #6b7280;
        }

        .btn {
            width: 100%;
            padding: 16px 32px;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: none;
        }

        .btn.show {
            display: block;
        }

        .btn-primary {
            background: var(--bg-gradient);
            color: white;
            box-shadow: 0 4px 14px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
            margin-top: 16px;
            box-shadow: 0 4px 14px rgba(5, 150, 105, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(5, 150, 105, 0.4);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 24px;
            color: var(--primary);
            font-weight: 500;
        }

        .loading.show {
            display: block;
        }

        .loading .spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid #e5e7eb;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 12px;
            vertical-align: middle;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .alert {
            padding: 16px 20px;
            border-radius: 10px;
            margin-bottom: 24px;
            display: none;
            font-weight: 500;
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid var(--success);
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid var(--danger);
        }

        /* Pie Chart Section */
        .chart-section {
            margin: 32px 0;
            display: none;
        }

        .chart-section.show {
            display: block;
        }

        .chart-container {
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid #e5e7eb;
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 16px;
            text-align: center;
        }

        #domainChart {
            width: 100%;
            height: 350px;
        }

        /* Results Section */
        .results {
            margin-top: 32px;
        }

        .domain-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .domain-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }

        .domain-card.banking {
            border-left: 5px solid var(--primary);
            background: linear-gradient(135deg, #f0f5ff 0%, #ffffff 100%);
        }

        .domain-card.banking.priority {
            border-left: 6px solid var(--primary);
            box-shadow: 0 8px 30px rgba(26, 86, 219, 0.2);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                box-shadow: 0 8px 30px rgba(26, 86, 219, 0.2);
            }

            50% {
                box-shadow: 0 8px 40px rgba(26, 86, 219, 0.35);
            }
        }

        .domain-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .domain-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .confidence-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            color: white;
        }

        .confidence-high {
            background: var(--success);
        }

        .confidence-medium {
            background: var(--warning);
        }

        .confidence-low {
            background: var(--danger);
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }

        .stat-box {
            background: white;
            padding: 16px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #e5e7eb;
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.85rem;
            color: #6b7280;
            margin-top: 4px;
        }

        .keywords-section {
            margin-top: 20px;
        }

        .keywords-section h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 10px;
        }

        .keyword-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .keyword-tag {
            background: #e0e7ff;
            color: var(--primary-dark);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        /* File Analysis Summary */
        .file-summary {
            background: linear-gradient(135deg, #e3f2fd 0%, #ffffff 100%);
            border-radius: 12px;
            padding: 24px;
            margin: 24px 0;
            border: 1px solid #90caf9;
        }

        .file-summary h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1976D2;
            margin-bottom: 16px;
        }

        .file-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
        }

        .file-summary-item {
            background: white;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e5e7eb;
        }

        .file-summary-item .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1976D2;
        }

        .file-summary-item .label {
            font-size: 0.85rem;
            color: #6b7280;
            margin-top: 4px;
        }

        @media (max-width: 768px) {
            body {
                padding: 20px 16px;
            }

            .container {
                padding: 28px 20px;
            }

            .header h1 {
                font-size: 1.75rem;
            }

            .upload-zone {
                padding: 40px 24px;
            }

            .stats-row {
                grid-template-columns: repeat(2, 1fr);
            }

            #domainChart {
                height: 300px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üè¶ Banking Domain Analyzer</h1>
            <p>Upload your data files (CSV, Excel, SQL) to analyze business domains, identify banking applications, and
                detect column relationships.</p>
        </div>

        <div class="upload-zone" id="uploadZone">
            <div class="icon">üìÅ</div>
            <h3>Click or Drag & Drop Files</h3>
            <p>Upload up to 5 files for multi-file relationship analysis</p>
            <div class="file-types">
                <span class="file-type-badge">.CSV</span>
                <span class="file-type-badge">.XLSX</span>
                <span class="file-type-badge">.XLS</span>
                <span class="file-type-badge">.SQL</span>
            </div>
        </div>

        <input type="file" id="fileInput" accept=".sql,.csv,.xlsx,.xls" multiple>

        <div class="file-list" id="fileList">
            <h4>üìÑ Selected Files</h4>
            <div id="fileItems"></div>
        </div>

        <button class="btn btn-primary" id="uploadBtn">üöÄ Analyze Files</button>

        <div class="loading" id="loading">
            <span class="spinner"></span>
            Analyzing your files... This may take a moment.
        </div>

        <div class="alert" id="alert"></div>

        <!-- Domain Prediction Pie Chart -->
        <div class="chart-section" id="chartSection">
            <div class="chart-container">
                <h4 class="chart-title">üìä Domain Detection Results</h4>
                <div id="domainChart"></div>
            </div>
        </div>

        <!-- File Analysis Summary (for multi-file) -->
        <div class="file-summary" id="fileSummary" style="display: none;">
            <h4>üìÅ Multi-File Analysis Summary</h4>
            <div class="file-summary-grid" id="fileSummaryGrid"></div>
        </div>

        <div class="results" id="resultBox"></div>

        <button class="btn btn-secondary show" id="accountBtn" style="display: none;">
            üìä View Detailed Banking Analysis & Business Rules
        </button>
    </div>

    <script>
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const fileItems = document.getElementById('fileItems');
        const uploadBtn = document.getElementById('uploadBtn');
        const loading = document.getElementById('loading');
        const alert = document.getElementById('alert');
        const resultBox = document.getElementById('resultBox');
        const accountBtn = document.getElementById('accountBtn');
        const chartSection = document.getElementById('chartSection');
        const fileSummary = document.getElementById('fileSummary');

        let selectedFiles = [];
        let domainChart = null;

        // Upload Zone Events
        uploadZone.onclick = () => fileInput.click();

        fileInput.onchange = e => handleFiles(e.target.files);

        uploadZone.ondragover = e => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        };

        uploadZone.ondragleave = () => uploadZone.classList.remove('dragover');

        uploadZone.ondrop = e => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        };

        function handleFiles(files) {
            if (!files || files.length === 0) return;

            selectedFiles = Array.from(files).slice(0, 5);

            fileItems.innerHTML = selectedFiles.map(f => `
                <div class="file-item">
                    <span class="name">üìÑ ${f.name}</span>
                    <span class="size">${formatSize(f.size)}</span>
                </div>
            `).join('');

            fileList.classList.add('show');
            uploadBtn.classList.add('show');
        }

        function formatSize(bytes) {
            const units = ['B', 'KB', 'MB'];
            let i = Math.floor(Math.log(bytes) / Math.log(1024));
            return (bytes / Math.pow(1024, i)).toFixed(2) + ' ' + units[i];
        }

        function showAlert(msg, type) {
            alert.textContent = msg;
            alert.className = `alert alert-${type} show`;
        }

        // Upload Handler
        uploadBtn.onclick = async () => {
            const formData = new FormData();
            const isMulti = selectedFiles.length > 1;
            // Use relative URLs to work with any host/port
            const endpoint = isMulti ? "/upload-multiple" : "/upload";

            if (isMulti) {
                selectedFiles.forEach(f => formData.append("files", f));
            } else {
                formData.append("file", selectedFiles[0]);
            }

            uploadBtn.disabled = true;
            loading.classList.add('show');
            resultBox.innerHTML = '';
            alert.className = 'alert';
            chartSection.classList.remove('show');
            fileSummary.style.display = 'none';

            try {
                const res = await fetch(endpoint, {
                    method: "POST",
                    body: formData
                });

                if (!res.ok) {
                    const err = await res.json().catch(() => ({}));
                    throw new Error(err.detail || `Server error: ${res.status}`);
                }

                const data = await res.json();
                showAlert('‚úÖ Analysis Complete!', 'success');

                // Store all data in sessionStorage
                storeSessionData(data);

                // Display pie chart
                displayDomainChart(data);

                // Display multi-file summary if applicable
                if (data.multi_file_mode) {
                    displayFileSummary(data);
                }

                // Display results
                displayResults(data);

            } catch (err) {
                showAlert(`‚ùå ${err.message}`, 'error');
                console.error('Upload error:', err);
            } finally {
                uploadBtn.disabled = false;
                loading.classList.remove('show');
            }
        };

        function storeSessionData(data) {
            // Store Core Banking Business Rules (PRIORITY - Runs First)
            if (data.core_banking_business_rules) sessionStorage.setItem('coreBankingBusinessRules', JSON.stringify(data.core_banking_business_rules));
            
            // Store main banking data
            if (data.banking) sessionStorage.setItem('bankingResult', JSON.stringify(data.banking));
            if (data.banking_dataset_validator) sessionStorage.setItem('bankingDatasetValidator', JSON.stringify(data.banking_dataset_validator));
            if (data.core_banking_validator) sessionStorage.setItem('coreBankingValidator', JSON.stringify(data.core_banking_validator));
            if (data.banking_application_type) sessionStorage.setItem('bankingApplicationType', JSON.stringify(data.banking_application_type));

            // Store validation data
            const validationKeys = ['banking_account_validation', 'banking_account_check', 'banking_account_status',
                'banking_missing_columns', 'banking_balance_analysis', 'banking_customer_id_validation',
                'banking_transaction_validation', 'banking_transaction_type_validation', 'banking_pan_validation',
                'banking_debit_credit_validation', 'banking_fraud_detection', 'banking_foreign_key_check',
                'banking_purpose_detection', 'banking_probability_explanations', 'banking_column_purpose_report'];

            validationKeys.forEach(key => {
                if (data[key]) sessionStorage.setItem(key, JSON.stringify(data[key]));
            });

            // Multi-file data
            if (data.banking_blueprint) sessionStorage.setItem('bankingBlueprint', JSON.stringify(data.banking_blueprint));
            if (data.multi_file_mode) {
                sessionStorage.setItem('multiFileMode', 'true');
                // Store Core Banking Business Rules for multi-file (per-file results)
                if (data.core_banking_business_rules) {
                    // Combine all file results into one structure for UI
                    const combinedRules = {
                        multi_file: true,
                        files: data.core_banking_business_rules,
                        total_files: Object.keys(data.core_banking_business_rules).length
                    };
                    sessionStorage.setItem('coreBankingBusinessRules', JSON.stringify(combinedRules));
                }
                if (data.relationships) sessionStorage.setItem('multiFileRelationships', JSON.stringify(data.relationships));
                if (data.file_relationships) sessionStorage.setItem('fileRelationships', JSON.stringify(data.file_relationships));
                if (data.primary_keys) sessionStorage.setItem('multiFilePrimaryKeys', JSON.stringify(data.primary_keys));
                if (data.foreign_keys) sessionStorage.setItem('multiFileForeignKeys', JSON.stringify(data.foreign_keys));
                if (data.domain_detection) sessionStorage.setItem('multiFileDomainDetection', JSON.stringify(data.domain_detection));
                if (data.table_results) sessionStorage.setItem('multiFileTableResults', JSON.stringify(data.table_results));
                if (data.business_explanation) sessionStorage.setItem('businessExplanation', JSON.stringify(data.business_explanation));
                if (data.overall_verdict) sessionStorage.setItem('overallVerdict', JSON.stringify(data.overall_verdict));
                if (data.overall_confidence) sessionStorage.setItem('overallConfidence', JSON.stringify(data.overall_confidence));
            } else {
                sessionStorage.setItem('multiFileMode', 'false');
            }

            // Store all domain results
            ['financial', 'insurance', 'government', 'healthcare', 'retail', 'space', 'human_resource'].forEach(d => {
                if (data[d]) sessionStorage.setItem(d + 'Result', JSON.stringify(data[d]));
            });
        }

        function displayDomainChart(data) {
            chartSection.classList.add('show');

            // Collect domain data
            const domains = [];

            // Banking (primary)
            if (data.banking && data.banking.confidence_percentage > 0) {
                domains.push({ name: 'üè¶ Banking', value: data.banking.confidence_percentage, color: '#1a56db' });
            }

            // Other domains
            const domainMap = {
                'financial': { icon: 'üí∞', name: 'Financial', color: '#059669' },
                'insurance': { icon: 'üõ°Ô∏è', name: 'Insurance', color: '#d97706' },
                'government': { icon: 'üèõÔ∏è', name: 'Government', color: '#7c3aed' },
                'healthcare': { icon: 'ü©∫', name: 'Healthcare', color: '#0891b2' },
                'retail': { icon: 'üõçÔ∏è', name: 'Retail', color: '#e11d48' },
                'space': { icon: 'üöÄ', name: 'Space', color: '#4f46e5' },
                'human_resource': { icon: 'üë•', name: 'HR', color: '#ea580c' }
            };

            Object.keys(domainMap).forEach(key => {
                if (data[key] && data[key].confidence_percentage > 0 && data[key].decision !== 'SKIPPED') {
                    const d = domainMap[key];
                    domains.push({ name: `${d.icon} ${d.name}`, value: data[key].confidence_percentage, color: d.color });
                }
            });

            // Sort by confidence
            domains.sort((a, b) => b.value - a.value);

            // Take top 5
            const topDomains = domains.slice(0, 5);

            // Initialize chart
            if (domainChart) {
                domainChart.dispose();
            }

            domainChart = echarts.init(document.getElementById('domainChart'));

            const option = {
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}: {c}%'
                },
                legend: {
                    orient: 'vertical',
                    right: '5%',
                    top: 'center',
                    textStyle: { fontSize: 14 }
                },
                series: [{
                    name: 'Domain Confidence',
                    type: 'pie',
                    radius: ['40%', '70%'],
                    center: ['40%', '50%'],
                    avoidLabelOverlap: true,
                    itemStyle: {
                        borderRadius: 8,
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    label: {
                        show: true,
                        formatter: '{b}\n{c}%',
                        fontSize: 12
                    },
                    emphasis: {
                        label: {
                            show: true,
                            fontSize: 16,
                            fontWeight: 'bold'
                        },
                        itemStyle: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    },
                    data: topDomains.map(d => ({
                        name: d.name,
                        value: d.value,
                        itemStyle: { color: d.color }
                    }))
                }]
            };

            domainChart.setOption(option);

            // Resize on window resize
            window.addEventListener('resize', () => {
                if (domainChart) domainChart.resize();
            });
        }

        function displayFileSummary(data) {
            fileSummary.style.display = 'block';

            const grid = document.getElementById('fileSummaryGrid');
            const tables = data.table_results || [];
            const totalFiles = data.total_files || tables.length;
            const relationships = data.relationships || [];
            const foreignKeys = data.foreign_keys || [];

            let totalColumns = 0;
            let totalRows = 0;
            tables.forEach(t => {
                totalColumns += (t.columns || []).length;
                totalRows += t.total_rows || 0;
            });

            grid.innerHTML = `
                <div class="file-summary-item">
                    <div class="value">${totalFiles}</div>
                    <div class="label">Files Analyzed</div>
                </div>
                <div class="file-summary-item">
                    <div class="value">${totalColumns}</div>
                    <div class="label">Total Columns</div>
                </div>
                <div class="file-summary-item">
                    <div class="value">${totalRows.toLocaleString()}</div>
                    <div class="label">Total Rows</div>
                </div>
                <div class="file-summary-item">
                    <div class="value">${relationships.length || foreignKeys.length}</div>
                    <div class="label">Relationships Found</div>
                </div>
            `;
        }

        function getConfidenceClass(confidence) {
            if (confidence >= 70) return 'confidence-high';
            if (confidence >= 50) return 'confidence-medium';
            return 'confidence-low';
        }

        function displayResults(data) {
            let html = '';

            // Banking Domain Result
            if (data.banking && typeof data.banking === 'object') {
                const b = data.banking;
                const conf = b.confidence_percentage || 0;
                const isPriority = b.decision && b.decision.toLowerCase() !== 'unknown' && conf > 70;

                html += `
                    <div class="domain-card banking ${isPriority ? 'priority' : ''}">
                        <div class="domain-header">
                            <h3>üè¶ Banking Domain ${isPriority ? '<span style="background:#1a56db;color:white;padding:4px 10px;border-radius:12px;font-size:0.75rem;margin-left:8px;">HIGH PRIORITY</span>' : ''}</h3>
                            <span class="confidence-badge ${getConfidenceClass(conf)}">${conf}%</span>
                        </div>
                        
                        <div class="stats-row">
                            <div class="stat-box">
                                <div class="stat-value">${b.domain || 'N/A'}</div>
                                <div class="stat-label">Domain</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-value">${b.decision || 'N/A'}</div>
                                <div class="stat-label">Decision</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-value">${b.total_columns || 0}</div>
                                <div class="stat-label">Columns</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-value">${b.confidence_out_of_10 || 0}/10</div>
                                <div class="stat-label">Rating</div>
                            </div>
                        </div>
                        
                        ${b.matched_keywords && b.matched_keywords.length > 0 ? `
                            <div class="keywords-section">
                                <h4>üîç Matched Keywords</h4>
                                <div class="keyword-tags">
                                    ${b.matched_keywords.map(k => `<span class="keyword-tag">${k}</span>`).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${b.matched_columns && b.matched_columns.length > 0 ? `
                            <div class="keywords-section">
                                <h4>üìã Matched Columns</h4>
                                <div class="keyword-tags">
                                    ${b.matched_columns.map(c => `<span class="keyword-tag" style="font-family:monospace;">${c}</span>`).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;

                accountBtn.style.display = 'block';
            }

            // Other domains (simplified display)
            const domains = [
                { key: 'financial', icon: 'üí∞', name: 'Financial' },
                { key: 'insurance', icon: 'üõ°Ô∏è', name: 'Insurance' },
                { key: 'government', icon: 'üèõÔ∏è', name: 'Government' },
                { key: 'healthcare', icon: 'ü©∫', name: 'Healthcare' },
                { key: 'retail', icon: 'üõçÔ∏è', name: 'Retail' },
                { key: 'space', icon: 'üöÄ', name: 'Space' },
                { key: 'human_resource', icon: 'üë•', name: 'Human Resource' }
            ];

            domains.forEach(d => {
                if (data[d.key] && data[d.key].confidence_percentage > 0 && data[d.key].decision !== 'SKIPPED') {
                    const r = data[d.key];
                    html += `
                        <div class="domain-card">
                            <div class="domain-header">
                                <h3>${d.icon} ${d.name} Domain</h3>
                                <span class="confidence-badge ${getConfidenceClass(r.confidence_percentage)}">${r.confidence_percentage}%</span>
                            </div>
                            <div class="stats-row">
                                <div class="stat-box">
                                    <div class="stat-value" style="font-size:1.2rem;">${r.decision || 'N/A'}</div>
                                    <div class="stat-label">Decision</div>
                                </div>
                                <div class="stat-box">
                                    <div class="stat-value">${r.total_columns || 0}</div>
                                    <div class="stat-label">Columns</div>
                                </div>
                            </div>
                        </div>
                    `;
                }
            });

            resultBox.innerHTML = html;
        }

        accountBtn.onclick = () => {
            window.location.href = '/account';
        };
    </script>
</body>

</html>